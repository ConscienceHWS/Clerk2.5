[Unit]
Description=PDF Converter API Service v2
Documentation=https://github.com/your-repo/pdf-converter
After=network.target
Wants=network-online.target

[Service]
Type=simple
# 服务运行用户（根据实际情况修改）
User=root
# 服务组（可选）
Group=root

# 工作目录
WorkingDirectory=/mnt/win_d/Clerk2.5

# Python 虚拟环境路径（根据实际情况修改）
# 如果使用虚拟环境，取消注释并修改路径
# Environment="PATH=/mnt/win_d/Clerk2.5/venv/bin:/usr/local/bin:/usr/bin:/bin"
Environment="PYTHONPATH=/mnt/win_d/Clerk2.5"

# API 服务配置
Environment="API_HOST=0.0.0.0"
Environment="API_PORT=4214"

# 日志配置
Environment="PDF_CONVERTER_LOG_DIR=/mnt/win_d/Clerk2.5/logs"
Environment="LOG_LEVEL=INFO"

# 外部API配置（v2版本使用外部API）
Environment="API_URL=http://192.168.2.3:8000"
Environment="BACKEND=vlm-vllm-async-engine"
Environment="PARSE_METHOD=auto"
Environment="LANGUAGE=ch"

# 启动命令（使用命令行参数）
# 如果使用虚拟环境，修改为: /mnt/win_d/Clerk2.5/venv/bin/python
ExecStart=/usr/bin/python3 /mnt/win_d/Clerk2.5/pdf_converter_v2/api_server.py --host 0.0.0.0 --port 4214 --log-level info

# 重启策略
Restart=always
RestartSec=10
StartLimitInterval=300
StartLimitBurst=5

# 日志配置
StandardOutput=journal
StandardError=journal
SyslogIdentifier=pdf-converter-v2
SyslogFacility=local0

# 资源限制（可选，根据实际情况调整）
# LimitNOFILE=65536
# LimitNPROC=4096

# 安全设置（可选）
# NoNewPrivileges=true
# PrivateTmp=true
# ProtectSystem=strict
# ProtectHome=true
# ReadWritePaths=/mnt/win_d/Clerk2.5/tmp /mnt/win_d/Clerk2.5/logs /mnt/win_d/Clerk2.5/pdf_converter_v2/test_output

[Install]
WantedBy=multi-user.target

